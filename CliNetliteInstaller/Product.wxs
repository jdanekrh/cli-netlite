<?xml version="1.0" encoding="UTF-8"?>
<?define version="1.3.0.0"?>
<?define UpgradeCode="a580c04f-caec-4e18-9134-c4b8f1c8f1be"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*"
           Name="cli-netlite"
           Language="1033"
           Version="$(var.version)"
           Manufacturer="David Kornel"
           UpgradeCode="$(var.UpgradeCode)">
    
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <Media Id="1" Cabinet="clinetlite.cab" EmbedCab="yes" />

    <WixVariable Id="WixUILicenseRtf" Value="/LICENSE.rtf" />

    <MajorUpgrade
      AllowDowngrades="no" DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit."
      AllowSameVersionUpgrades="yes"
      Schedule="afterInstallInitialize"
      />

    <UI>
      <UIRef Id="Custom_WixUI_Minimal"/>
    </UI>

		<Feature Id="ProductFeature" Title="cli-netlite" Level="1">
			<ComponentGroupRef Id="ProductComponents" />
		</Feature>
	</Product>

	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="CliNetlite"/>
			</Directory>
		</Directory>
	</Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="SenderExe" Guid="36195613-0263-44f0-ac1a-0d3e33a5ed1d">
        <File Id="SenderExecutable" Source="..\Sender\bin\Debug\cli-netlite-sender.exe" KeyPath="yes" Vital="yes" System="yes"/>
      </Component>
      <Component Id="ReceiverExe" Guid="4ec83438-b3a8-4955-ba9b-a003efdd5ee1">
        <File Id="ReceiverExecutable" Source="..\Receiver\bin\Debug\cli-netlite-receiver.exe" KeyPath="yes" Vital="yes" System="yes"/>
      </Component>
      <Component Id="ConnectorExe" Guid="b146d03d-7942-4fd3-bdc4-245c25a95e4b">
        <File Id="ConnectorExecutable" Source="..\Connector\bin\Debug\cli-netlite-connector.exe" KeyPath="yes" Vital="yes" System="yes"/>
      </Component>
      <Component Id="ClientLib.dll">
        <File Id="ClientLib.dll" Source="..\ClientLib\bin\Debug\ClientLib.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="Amqp.Net.dll">
        <File Id="Amqp.Net.dll" Source="..\ClientLib\bin\Debug\Amqp.Net.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NDesk.Options.dll">
        <File Id="NDesk.Options.dll" Source="..\ClientLib\bin\Debug\NDesk.Options.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="ClientLibNetCore.dll">
        <File Id="ClientLibNetCore.dll" Source="..\ClientLibNetCore\bin\Debug\netcoreapp2.0\ClientLibNetCore.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreSender.dll">
        <File Id="SenderCoreExecutable.dll" Source="..\NetCoreSender\bin\Debug\netcoreapp2.0\cli-netlite-core-sender.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreReceiver.dll">
        <File Id="ReceiverCoreExecutable.dll" Source="..\NetCoreReceiver\bin\Debug\netcoreapp2.0\cli-netlite-core-receiver.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreConnector.dll">
        <File Id="ConnectorCoreExecutable.dll" Source="..\NetCoreConnector\bin\Debug\netcoreapp2.0\cli-netlite-core-connector.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreSenderRunner.dll">
        <File Id="SenderCoreExecutableRunner.dll" Source="..\NetCoreSender\bin\Debug\netcoreapp2.0\cli-netlite-core-sender.runtimeconfig.json" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreReceiverRunner.dll">
        <File Id="ReceiverCoreExecutableRunner.dll" Source="..\NetCoreReceiver\bin\Debug\netcoreapp2.0\cli-netlite-core-receiver.runtimeconfig.json" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreConnectorRunner.dll">
        <File Id="ConnectorCoreExecutableRunner.dll" Source="..\NetCoreConnector\bin\Debug\netcoreapp2.0\cli-netlite-core-connector.runtimeconfig.json" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreSenderDeps.dll">
        <File Id="SenderCoreExecutableDeps.dll" Source="..\NetCoreSender\bin\Debug\netcoreapp2.0\cli-netlite-core-sender.deps.json" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreReceiverDeps.dll">
        <File Id="ReceiverCoreExecutableDeps.dll" Source="..\NetCoreReceiver\bin\Debug\netcoreapp2.0\cli-netlite-core-receiver.deps.json" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="NetCoreConnectorDeps.dll">
        <File Id="ConnectorCoreExecutableDeps.dll" Source="..\NetCoreConnector\bin\Debug\netcoreapp2.0\cli-netlite-core-connector.deps.json" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="jsonLib">
        <File Id="jsonLib" Source="../packages/Newtonsoft.Json.10.0.3/lib/netstandard1.3/Newtonsoft.Json.dll" KeyPath="yes" Checksum="yes"/>
      </Component>
      <Component Id="SetEnvPath"
                     Guid="{016cb18d-0357-425b-90a8-caf1826ddee6}">
        <CreateFolder />
        <Environment Id="PATH" Name="PATH" Value="[INSTALLFOLDER]" Permanent="no" Part="last" Action="set" System="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
  
  <Fragment>
    <Feature Id="MainApplication" Title="Main Application" Level="1">
      <ComponentRef Id="ClientLib.dll" />
      <ComponentRef Id="Amqp.Net.dll" />
      <ComponentRef Id="NDesk.Options.dll" />
      <ComponentRef Id="SenderExe" />
      <ComponentRef Id="ReceiverExe" />
      <ComponentRef Id="ConnectorExe"/>
      <ComponentRef Id="ClientLibNetCore.dll"/>
      <ComponentRef Id="SenderCoreExecutable.dll"/>
      <ComponentRef Id="ConnectorCoreExecutable.dll"/>
      <ComponentRef Id="ReceiverCoreExecutable.dll"/>
      <ComponentRef Id="SenderCoreExecutableRunner.dll"/>
      <ComponentRef Id="ConnectorCoreExecutableRunner.dll"/>
      <ComponentRef Id="ReceiverCoreExecutableRunner.dll"/>
      <ComponentRef Id="SenderCoreExecutableDeps.dll"/>
      <ComponentRef Id="ConnectorCoreExecutableDeps.dll"/>
      <ComponentRef Id="ReceiverCoreExecutableDeps.dll"/>
      <ComponentRef Id="jsonLib"/>
    </Feature>
  </Fragment>
</Wix>
